# GoF Comportamental - Command

O Command √© um padr√£o de projeto comportamental que tem como objetivo encapsular uma solicita√ß√£o como um objeto, permitindo que comandos possam ser executados, desfeitos, enfileirados ou registrados de maneira flex√≠vel.

Em outras palavras, o padr√£o transforma uma a√ß√£o em um objeto independente, desacoplando o emissor (quem solicita a a√ß√£o) do receptor (quem a executa).
Isso traz grande flexibilidade para sistemas que precisam de hist√≥rico de opera√ß√µes, filas de tarefas, macros, desfazer/refazer (undo/redo) ou integra√ß√£o com sistemas de execu√ß√£o remota (SERRANO, 2024).

---

## Intuito do Padr√£o

Segundo Serrano (2024), o Command serve para ‚Äúcontrolar as chamadas a um determinado componente, modelando cada requisi√ß√£o como um objeto, e permitindo que as opera√ß√µes possam ser desfeitas ou registradas‚Äù.

Em ess√™ncia, o padr√£o separa o pedido da sua execu√ß√£o, permitindo que diferentes a√ß√µes sejam representadas por objetos distintos ‚Äî cada um capaz de saber como executar e como desfazer sua pr√≥pria opera√ß√£o.

---

## Estrutura Conceitual

O GoF Command envolve quatro pap√©is principais:

| Papel               | Descri√ß√£o                                                                                                   |
| ------------------- | ----------------------------------------------------------------------------------------------------------- |
| **Command**         | Define a interface para executar e desfazer opera√ß√µes.                                                      |
| **ConcreteCommand** | Implementa a opera√ß√£o espec√≠fica, ligando o comando a um *Receiver*.                                        |
| **Receiver**        | √â o componente que realiza o trabalho real quando o comando √© executado.                                    |
| **Invoker**         | √â o solicitante da a√ß√£o ‚Äî o objeto que dispara o comando. Ele n√£o sabe o que o comando faz, apenas o chama. |

Essa separa√ß√£o promove independ√™ncia entre quem pede e quem executa a a√ß√£o, facilitando a manuten√ß√£o e a extens√£o do sistema (SERRANO, 2024).

---

## Benef√≠cios

- Desacoplamento total entre quem solicita e quem executa a a√ß√£o.

- Facilidade de extens√£o: novos comandos podem ser adicionados sem alterar o restante do sistema.

- Possibilidade de desfazer e refazer opera√ß√µes.

- Hist√≥rico e registro de a√ß√µes, permitindo reprocessamento e auditoria.

- Filas de execu√ß√£o e integra√ß√£o com event sourcing ou message queues.

Essas caracter√≠sticas tornam o padr√£o especialmente √∫til em sistemas distribu√≠dos, de automa√ß√£o ou com m√∫ltiplos pontos de controle (SERRANO, 2024).

---

## Quando Aplicar

O padr√£o Command √© indicado quando:

- O sistema precisa desfazer/refazer a√ß√µes do usu√°rio.

- H√° necessidade de filas de processamento ou reexecu√ß√£o de eventos.

- Deseja-se parametrizar objetos com diferentes solicita√ß√µes ou a√ß√µes configur√°veis.

- √â necess√°rio desacoplar o emissor do executor, mantendo a flexibilidade de substitui√ß√£o ou extens√£o.

Em suma, o padr√£o √© ideal para sistemas onde as a√ß√µes precisam ser controladas, armazenadas e manipuladas de forma din√¢mica (SERRANO, 2024).

---

## Aplica√ß√£o no projeto

Com base no cen√°rio de estudo proposto para esta disciplina, foi criado a seguinte estrutura de c√≥digo para ilustrar a sua aplica√ß√£o, levando em considera√ß√£o o [Diagrama de Classes](https://unbarqdsw2025-2-turma01.github.io/2025.2-T01-G7_PodePedirFCTE_Entrega_02/#/./Modelagem/ModelagemEstatica/DiagramaDeClasses) da entrega 2.

---

### Diagrama de Classes

Para modelar o padr√£o de projeto, fizemos um diagrama de classes utilizando o [Mermaid Chart](https://www.mermaidchart.com/app/dashboard).

<!-- <img src="../../assets/command-diagrama.png" alt="Diagrama Factory Method" width="900" height="400"> -->
![diagrama command](../../assets/command-diagrama.png)

---

### Command - PodePedirFCTE

Este exemplo simula o m√≥dulo de controle de pedidos, onde cada a√ß√£o sobre o pedido (confirmar, cancelar, reagendar) √© tratada como um objeto de comando independente, podendo ser executada, desfeita e registrada no hist√≥rico.

---

#### Estrutura de pastas

```json
podepedir-command/
  src/
    domain.ts
    command/
      command.ts
      concrete-commands.ts
      invoker.ts
    receiver/
      pedido-service.ts
    main.ts
  package.json
  tsconfig.json
```
---

#### 1) package.json
```json
{
  "name": "podepedir-command-demo",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "tsx src/main.ts",
    "dev": "tsx watch src/main.ts",
    "build": "tsc -p ."
  },
  "devDependencies": {
    "tsx": "^4.19.2",
    "typescript": "^5.6.3"
  }
}
```

---

#### 2) tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022",
    "moduleResolution": "bundler",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "outDir": "dist"
  },
  "include": ["src"]
}
```

---

#### 3) src/domain.ts
```TS
export type ID = string | number;

export enum StatusPedido {
  PENDENTE = "PENDENTE",
  CONFIRMADO = "CONFIRMADO",
  CANCELADO = "CANCELADO",
  REAGENDADO = "REAGENDADO",
}

export interface Pedido {
  id: ID;
  aluno: string;
  fornecedor: string;
  dataEntrega: Date;
  status: StatusPedido;
}
```

---

#### 4) src/receiver/pedido-service.ts

Receiver ‚Äì respons√°vel por executar o trabalho real.
```TS
import { Pedido, StatusPedido } from "../domain";

export class PedidoService {
  constructor(private pedido: Pedido) {}

  confirmar() {
    if (this.pedido.status === StatusPedido.CONFIRMADO) {
      console.log(`Pedido ${this.pedido.id} j√° est√° confirmado.`);
      return;
    }
    this.pedido.status = StatusPedido.CONFIRMADO;
    console.log(`‚úÖ Pedido ${this.pedido.id} confirmado.`);
  }

  cancelar() {
    if (this.pedido.status === StatusPedido.CANCELADO) {
      console.log(`Pedido ${this.pedido.id} j√° est√° cancelado.`);
      return;
    }
    this.pedido.status = StatusPedido.CANCELADO;
    console.log(`üö´ Pedido ${this.pedido.id} cancelado.`);
  }

  reagendar(novaData: Date) {
    this.pedido.status = StatusPedido.REAGENDADO;
    this.pedido.dataEntrega = novaData;
    console.log(
      `üìÖ Pedido ${this.pedido.id} reagendado para ${novaData.toLocaleDateString()}.`
    );
  }

  getStatus() {
    return this.pedido.status;
  }
}
```

---

#### 5) src/command/command.ts

Command interface ‚Äì define a estrutura de execu√ß√£o e desfazer.

```TS
export interface Command {
  execute(): void;
  undo(): void;
  descricao(): string;
}
```

---

#### 6) src/command/concrete-commands.ts

ConcreteCommand ‚Äì cada comando encapsula uma a√ß√£o do PedidoService.

```TS
import { Command } from "./command";
import { PedidoService } from "../receiver/pedido-service";
import { StatusPedido } from "../domain";

export class ConfirmarPedidoCommand implements Command {
  private estadoAnterior: StatusPedido | null = null;
  constructor(private receiver: PedidoService) {}

  execute() {
    this.estadoAnterior = this.receiver.getStatus();
    this.receiver.confirmar();
  }

  undo() {
    if (this.estadoAnterior) {
      console.log(`‚Ü©Ô∏è Desfazendo confirma√ß√£o...`);
      if (this.estadoAnterior === StatusPedido.PENDENTE)
        console.log(`Pedido voltou para PENDENTE.`);
    }
  }

  descricao() {
    return "Confirmar Pedido";
  }
}

export class CancelarPedidoCommand implements Command {
  private estadoAnterior: StatusPedido | null = null;
  constructor(private receiver: PedidoService) {}

  execute() {
    this.estadoAnterior = this.receiver.getStatus();
    this.receiver.cancelar();
  }

  undo() {
    if (this.estadoAnterior) {
      console.log(`‚Ü©Ô∏è Revertendo cancelamento...`);
      if (this.estadoAnterior === StatusPedido.PENDENTE)
        console.log(`Pedido voltou para PENDENTE.`);
    }
  }

  descricao() {
    return "Cancelar Pedido";
  }
}

export class ReagendarPedidoCommand implements Command {
  private estadoAnterior: StatusPedido | null = null;
  private dataAnterior: Date | null = null;

  constructor(private receiver: PedidoService, private novaData: Date) {}

  execute() {
    this.estadoAnterior = this.receiver.getStatus();
    this.dataAnterior = new Date();
    this.receiver.reagendar(this.novaData);
  }

  undo() {
    if (this.estadoAnterior && this.dataAnterior) {
      console.log(`‚Ü©Ô∏è Desfazendo reagendamento...`);
      console.log(`Pedido voltaria √† data anterior: ${this.dataAnterior}`);
    }
  }

  descricao() {
    return "Reagendar Pedido";
  }
}
```

---

#### 7) src/command/invoker.ts

Invoker ‚Äì solicita a execu√ß√£o e mant√©m o hist√≥rico.

```TS
import { Command } from "./command";

export class PedidoInvoker {
  private historico: Command[] = [];

  executar(cmd: Command) {
    console.log(`\n[Executando comando: ${cmd.descricao()}]`);
    cmd.execute();
    this.historico.push(cmd);
  }

  desfazerUltimo() {
    const cmd = this.historico.pop();
    if (!cmd) {
      console.log("Nenhum comando para desfazer.");
      return;
    }
    console.log(`\n[Desfazendo comando: ${cmd.descricao()}]`);
    cmd.undo();
  }

  listarHistorico() {
    console.log("\n=== Hist√≥rico de comandos ===");
    this.historico.forEach((c, i) =>
      console.log(`${i + 1}. ${c.descricao()}`)
    );
  }
}
```

---

#### 8) src/main.ts

Simula√ß√£o pr√°tica do padr√£o Command.

```TS
import { Pedido, StatusPedido } from "./domain";
import { PedidoService } from "./receiver/pedido-service";
import {
  ConfirmarPedidoCommand,
  CancelarPedidoCommand,
  ReagendarPedidoCommand,
} from "./command/concrete-commands";
import { PedidoInvoker } from "./command/invoker";

const pedido: Pedido = {
  id: "PED-2025-001",
  aluno: "Lucas Almeida",
  fornecedor: "Cantina FCTE",
  dataEntrega: new Date("2025-10-25"),
  status: StatusPedido.PENDENTE,
};

const service = new PedidoService(pedido);
const invoker = new PedidoInvoker();

// Cria√ß√£o dos comandos
const cmdConfirmar = new ConfirmarPedidoCommand(service);
const cmdReagendar = new ReagendarPedidoCommand(service, new Date("2025-10-28"));
const cmdCancelar = new CancelarPedidoCommand(service);

// Execu√ß√£o sequencial
invoker.executar(cmdConfirmar);
invoker.executar(cmdReagendar);
invoker.executar(cmdCancelar);

// Hist√≥rico e desfazer
invoker.listarHistorico();
invoker.desfazerUltimo();
```

---
### Sa√≠da esperada

Ao executar o c√≥digo acima, a sa√≠da que se espera visualizar no terminal √©:
``` 
[Executando comando: Confirmar Pedido]
‚úÖ Pedido PED-2025-001 confirmado.

[Executando comando: Reagendar Pedido]
üìÖ Pedido PED-2025-001 reagendado para 27/10/2025.

[Executando comando: Cancelar Pedido]
üö´ Pedido PED-2025-001 cancelado.

=== Hist√≥rico de comandos ===
1. Confirmar Pedido
2. Reagendar Pedido
3. Cancelar Pedido

[Desfazendo comando: Cancelar Pedido]
‚Ü©Ô∏è Revertendo cancelamento...
```

---

## Quadro de Participa√ß√µes

| **Membro da equipe** | **Fun√ß√£o** |
| :------------- | :--------- |
| [Ana Clara](https://github.com/anabborges) | Cria√ß√£o do Diagrama de Classes |
| [Guilherme Storch](https://github.com/storch7) | Documenta√ß√£o e Implementa√ß√£o do padr√£o  |

## Refer√™ncias

> SERRANO, Milene. Arquitetura e Desenho de Software ‚Äì Aula GoFs Comportamentais. Universidade de Bras√≠lia, 2024. Material did√°tico apresentado na disciplina de Arquitetura e Desenho de Software ‚Äì Padr√µes GoF Comportamentais.

---

### Execu√ß√£o

O arquivo a seguir cont√©m o c√≥digo execut√°vel com a estrutura acima abordada. [Link para download.](https://drive.google.com/file/d/1uOaw5QBZIMmQ7B_pt3t8iv99rdFE3Hk4/view?usp=sharing)

O c√≥digo acima foi desenvolvido em TypeScript, com a ver√£o.
- Node JS na vers√£o: `v22.14.0`


Executar os comandos abaixo, na pasta raiz do projeto:
- `npm i` -> instala as depend√™ncias para execu√ß√£o do c√≥digo
- `npm run start` -> executa o c√≥digo desenvolvido

---

## Hist√≥rico de Vers√µes

| **Data**       | **Vers√£o** | **Descri√ß√£o**                         | **Autor**                                      | **Revisor**                                      | **Data da Revis√£o** |
| :--------: | :----: | :-------------------------------- | :----------------------------------------: | :----------------------------------------: | :-------------: |
| 22/10/2025 |  `1.0`   | Cria√ß√£o da p√°gina. | [`@storch7`](https://github.com/storch7) | [`@Ana Joyce`](https://github.com/anajoyceamorim) |   24/10/2025    |
| 24/10/2025 |  `1.0`   | Adicionando o arquivo execut√°vel | [`@storch7`](https://github.com/storch7) | [`@Ana Joyce`](https://github.com/anajoyceamorim) |   24/10/2025    |
| 24/10/2025 |  `1.1`   | Adiciona o diagrama de classes | [`@Ana Clara`](https://github.com/anabborges) | [`@storch7`](https://github.com/storch7) |   24/10/2025    |